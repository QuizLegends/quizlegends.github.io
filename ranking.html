<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Global - Quiz Legends</title>
    <style>
        :root {
            --ouro: #c89b3c;
            --ouro-brilhante: #f0e6d2;
            --fundo-profundo: #010a13;
            --card-azul: #091428;
            --borda-item: rgba(200, 155, 60, 0.3);
        }

        body {
            background: radial-gradient(circle at center, #091428 0%, var(--fundo-profundo) 100%);
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Título Estilo League */
        .header-ranking {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--ouro);
            padding-bottom: 10px;
        }

        .header-ranking h1 {
            color: var(--ouro);
            text-transform: uppercase;
            letter-spacing: 4px;
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(200, 155, 60, 0.5);
        }

        /* Lista de Ranking */
        #lista-ranking {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            background: linear-gradient(90deg, var(--card-azul) 0%, rgba(1, 10, 19, 0.9) 100%);
            border: 1px solid var(--borda-item);
            padding: 12px 15px;
            border-radius: 4px;
            transition: transform 0.2s;
            animation: slideIn 0.4s ease-out;
        }

        .ranking-item:hover {
            border-color: var(--ouro);
            transform: scale(1.02);
            background: var(--card-azul);
        }

        /* Posição 1°, 2°, 3° */
        .posicao {
            font-weight: 900;
            font-size: 1.1rem;
            width: 45px;
            color: var(--ouro-brilhante);
        }

        .top-3 {
            color: var(--ouro);
            font-size: 1.3rem;
            text-shadow: 0 0 5px var(--ouro);
        }

        /* Nome do Jogador */
        .nome {
            flex-grow: 1;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            margin: 0 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Badge do Elo */
        .elo-badge {
            font-size: 0.65rem;
            font-weight: 900;
            padding: 4px 8px;
            border-radius: 3px;
            text-transform: uppercase;
            min-width: 90px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* PDL do Jogador */
        .pdl-valor {
            font-size: 0.85rem;
            color: var(--ouro-brilhante);
            font-weight: bold;
            margin-left: 15px;
            min-width: 80px;
            text-align: right;
        }

        /* Botão Voltar */
        .btn-voltar {
            display: block;
            width: fit-content;
            margin: 30px auto;
            background: transparent;
            border: 2px solid var(--ouro);
            color: var(--ouro);
            padding: 10px 30px;
            text-decoration: none;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-voltar:hover {
            background: var(--ouro);
            color: var(--fundo-profundo);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .loading { text-align: center; color: var(--ouro); margin-top: 50px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-ranking">
            <h1>Ranking Global</h1>
        </div>

        <div id="lista-ranking">
            <div class="loading">Sincronizando com o Reino...</div>
        </div>

        <a href="resgate.html" class="btn-voltar">Voltar</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyC4dm0KoyJswhyCY7tgbF4D2nmuZl84X8E", 
            authDomain: "quizlegends-f58fc.firebaseapp.com", 
            projectId: "quizlegends-f58fc", 
            storageBucket: "quizlegends-f58fc.firebasestorage.app", 
            messagingSenderId: "1050463164018", 
            appId: "1:1050463164018:web:91de002b8afc8e678f54eb" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // CONFIGURAÇÃO DE ELOS (Igual ao seu sistema principal)
        const configElo = [];
        const divisoes = ["V", "IV", "III", "II", "I"];
        const coresElos = {
            "FERRO": { bg: "#2a2a2a", color: "#8a8a8a" },
            "PRATA": { bg: "#4a5d6e", color: "#e2e2e2" },
            "OURO": { bg: "#7a5c12", color: "#f1d37e" },
            "PLATINA": { bg: "#1d5c5c", color: "#a3e7e7" },
            "ESMERALDA": { bg: "#0d5c2e", color: "#a3e7bc" },
            "DIAMANTE": { bg: "#1f3a7a", color: "#b3c7f7" }
        };

        function gerarEloComDivisoes(nome, min, max) {
            let passo = (max - min) / 5;
            divisoes.forEach((div, i) => {
                configElo.push({ nome: `${nome} ${div}`, min: min + (passo * i), max: min + (passo * (i + 1)), ...coresElos[nome] });
            });
        }
        gerarEloComDivisoes("FERRO", 0, 2500);
        gerarEloComDivisoes("PRATA", 2500, 5000);
        gerarEloComDivisoes("OURO", 5000, 15000);
        gerarEloComDivisoes("PLATINA", 15000, 25000);
        gerarEloComDivisoes("ESMERALDA", 25000, 40000);
        gerarEloComDivisoes("DIAMANTE", 40000, 60000);
        configElo.push({ nome: "MESTRE", min: 60000, max: 80000, bg: "#5a1f7a", color: "#dfb3f7" });
        configElo.push({ nome: "GRÃO-MESTRE", min: 80000, max: 100000, bg: "#7a1f1f", color: "#f7b3b3" });
        configElo.push({ nome: "DESAFIANTE", min: 100000, max: 9999999, bg: "#1a4a5a", color: "#b3e7f7" });

        function getEloInfo(valorXP) { 
            if (valorXP <= 0) return configElo[0];
            return configElo.find(e => valorXP >= e.min && valorXP < e.max) || configElo[configElo.length - 1]; 
        }

        // LÓGICA DO RANKING
        async function carregarRanking() {
            try {
                // Query rigorosa: Ordena por XP descendente (maior PDL primeiro)
                const q = query(collection(db, "usuarios"), orderBy("xp", "desc"), limit(50));
                const querySnapshot = await getDocs(q);
                
                const container = document.getElementById('lista-ranking');
                container.innerHTML = ""; // Limpa o loading

                let posicao = 1;

                querySnapshot.forEach((doc) => {
                    const usuario = doc.data();
                    const xpAtual = usuario.xp || 0;
                    const eloInfo = getEloInfo(xpAtual);
                    const isTop3 = posicao <= 3 ? 'top-3' : '';

                    const item = document.createElement('div');
                    item.className = 'ranking-item';
                    item.innerHTML = `
                        <div class="posicao ${isTop3}">${posicao}°</div>
                        <div class="elo-badge" style="background:${eloInfo.bg}; color:${eloInfo.color}">
                            ${eloInfo.nome}
                        </div>
                        <div class="nome">${usuario.nome || "Invocador"}</div>
                        <div class="pdl-valor">${Math.floor(xpAtual).toLocaleString()} <small>PDL</small></div>
                    `;
                    container.appendChild(item);
                    posicao++;
                });

            } catch (error) {
                console.error("Erro ao carregar ranking:", error);
                document.getElementById('lista-ranking').innerHTML = "Erro ao carregar dados.";
            }
        }

        // Inicia a carga do ranking ao abrir a página
        carregarRanking();
    </script>
</body>
</html>
