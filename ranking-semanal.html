<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking Semanal - Quiz Legends</title>
    <style>
        :root {
            --gold: #c89b3c;
            --silver: #a5a9b4;
            --bronze: #cd7f32;
            --dark-bg: #09090b;
            --card-bg: #121214;
            --text: #f0f0f0;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .ranking-container {
            width: 100%;
            max-width: 600px;
            background: var(--card-bg);
            border: 1px solid #2a2a2e;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .ranking-header {
            background: linear-gradient(180deg, #1a1a1c 0%, #121214 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--gold);
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid #2a2a2e;
            gap: 15px;
        }

        /* Espaço do Ícone */
        .user-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #3e3e42;
            object-fit: cover;
            background: #252529;
        }

        .pos-num {
            width: 30px;
            font-weight: 800;
            font-size: 1.1rem;
            color: #71717a;
        }

        .user-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .user-pdl {
            font-size: 0.85rem;
            color: #28a745;
            font-weight: bold;
        }

        /* Recompensas */
        .reward-box {
            text-align: right;
            min-width: 80px;
        }

        .reward-gold {
            color: var(--gold);
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
        }

        /* Destaques Top 3 */
        .top-1 { background: rgba(200, 155, 60, 0.08); }
        .top-1 .pos-num { color: var(--gold); font-size: 1.4rem; }
        .top-1 .user-icon { border-color: var(--gold); }

        .top-2 .pos-num { color: var(--silver); }
        .top-3 .pos-num { color: var(--bronze); }

        .btn-voltar {
            margin-top: 25px;
            text-decoration: none;
            color: #71717a;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        .btn-voltar:hover { color: var(--gold); }
    </style>
</head>
<body>

    <div class="ranking-header">
        <h2 style="margin:0; color:var(--gold);">TOP LENDAS DA SEMANA</h2>
        <p style="margin:5px 0 0; font-size:0.8rem; color:#71717a;">Reinicia em: <span id="timer-semanal">Domingo, 23:59</span></p>
    </div>

    <div class="ranking-container" id="ranking-lista">
        </div>

    <a href="index.html" class="btn-voltar">← Voltar para a Arena</a>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyC4dm0KoyJswhyCY7tgbF4D2nmuZl84X8E", 
            authDomain: "quizlegends-f58fc.firebaseapp.com", 
            projectId: "quizlegends-f58fc", 
            storageBucket: "quizlegends-f58fc.firebasestorage.app", 
            messagingSenderId: "1050463164018", 
            appId: "1:1050463164018:web:91de002b8afc8e678f54eb" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Função para definir o prêmio em moedas baseado na posição
        function calcularPremio(pos) {
            if (pos === 1) return 5000;
            if (pos === 2) return 2500;
            if (pos === 3) return 1250;
            if (pos <= 10) return 500;
            return 100;
        }

        async function carregarRanking() {
            const container = document.getElementById('ranking-lista');
            const q = query(collection(db, "usuarios"), orderBy("xp", "desc"), limit(20));
            
            try {
                const snapshot = await getDocs(q);
                let html = "";
                let i = 1;

                snapshot.forEach(doc => {
                    const user = doc.data();
                    const premio = calcularPremio(i);
                    const foto = user.photoURL || 'https://via.placeholder.com/45?text=L'; // Placeholder se não tiver foto

                    html += `
                        <div class="ranking-item top-${i <= 3 ? i : 'out'}">
                            <div class="pos-num">${i}º</div>
                            <img src="${foto}" class="user-icon" alt="Avatar">
                            <div class="user-info">
                                <span class="user-name">${user.nome || 'Invocador'}</span>
                                <span class="user-pdl">${user.xp || 0} PDL na Semana</span>
                            </div>
                            <div class="reward-box">
                                <div class="reward-gold">
                                    <span>+${premio}</span>
                                    <img src="https://cdn-icons-png.flaticon.com/512/272/272525.png" width="14" alt="gold">
                                </div>
                                <div style="font-size:0.7rem; color:#71717a;">Prêmio Est.</div>
                            </div>
                        </div>
                    `;
                    i++;
                });
                container.innerHTML = html;
            } catch (e) {
                container.innerHTML = "<p style='padding:20px;'>Erro ao carregar ranking.</p>";
            }
        }

        carregarRanking();
    </script>
</body>
</html>
