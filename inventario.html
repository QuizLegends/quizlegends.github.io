<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°rio Hextech - Quiz Legends</title>
    <style>
        :root {
            --ouro: #c89b3c;
            --ouro-claro: #f0e6d2;
            --fundo: #010a13;
            --card-bg: rgba(9, 20, 40, 0.9);
            --azul-hex: #091428;
            --comum: #808080;
            --raro: #00cfbc;
            --epico: #a335ee;
            /* NOVA RARIDADE PRISM√ÅTICA */
            --prismatico: linear-gradient(135deg, #1bc8ce 0%, #cefff7 25%, #4739b2 50%, #1bc8ce 75%, #fff311 100%);
        }

        body {
            background: radial-gradient(circle at center, #0a323c 0%, #010a13 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .header-inv {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--ouro);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .header-inv h1 {
            margin: 0;
            font-size: 1.5rem;
            letter-spacing: 3px;
            background: linear-gradient(to bottom, var(--ouro-claro), var(--ouro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
        }

        /* Container que agrupa busca e filtros */
        .barra-ferramentas-inventario {
            display: flex;
            justify-content: center; 
            align-items: center;
            flex-wrap: wrap;
            gap: 30px; 
            background: rgba(1, 10, 19, 0.8);
            padding: 15px 20px;
            border: 1px solid #1e2328;
            box-sizing: border-box;
            margin: 0 auto 30px;
            max-width: 1000px; /* Mesma largura da grade da loja */
        }

        /* Campo de Busca Exato */
        .busca-container-inv {
            position: relative;
            width: 300px; 
            max-width: 100%;
        }

        .busca-container-inv input {
            width: 100%;
            background: #091428;
            border: 1px solid var(--ouro);
            padding: 10px 40px 10px 15px; /* Espa√ßo para a lupa na direita */
            color: white;
            outline: none;
            box-sizing: border-box;
            font-size: 0.9rem;
        }

        .busca-container-inv span {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--ouro);
            pointer-events: none;
        }

        /* Bot√µes de Filtro de Raridade */
        .filtros-raridade-inv {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn-inv {
            background: transparent;
            border: 1px solid #333;
            color: #888;
            padding: 7px 15px; 
            font-size: 11px;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.2s;
            min-width: 70px;
        }

        /* Estados ativos conforme sua loja */
        .filter-btn-inv.active { border-color: var(--ouro); color: var(--ouro); background: rgba(200, 155, 60, 0.1); }

        .grid-inventario {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 25px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .item-card {
            background: var(--card-bg);
            border: 1px solid #1e2328;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            transition: all 0.3s;
            clip-path: polygon(10% 0, 90% 0, 100% 10%, 100% 90%, 90% 100%, 10% 100%, 0 90%, 0 10%);
        }

        .item-card:hover { transform: translateY(-5px); }

        .item-card.comum { border-color: var(--comum); filter: drop-shadow(0 0 5px var(--comum)); }
        .item-card.raro { border-color: var(--raro); filter: drop-shadow(0 0 10px var(--raro)); }
        .item-card.epico { border-color: var(--epico); filter: drop-shadow(0 0 15px var(--epico)); }

        /* --- ATUALIZADO: ESTILO PRISM√ÅTICO NO INVENT√ÅRIO COM PULSAR --- */
        .item-card.prismatico {
            border: 1px solid transparent !important;
            background-image: linear-gradient(var(--card-bg), var(--card-bg)), var(--prismatico);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            filter: drop-shadow(0 0 15px rgba(27, 200, 206, 0.5));
            animation: animaPrismatico 2s ease-in-out infinite;
        }

        @keyframes animaPrismatico {
            0% { transform: scale(1); filter: drop-shadow(0 0 10px #1bc8ce) brightness(1.1); }
            50% { transform: scale(1.05); filter: drop-shadow(0 0 25px #fff311) brightness(1.3); }
            100% { transform: scale(1); filter: drop-shadow(0 0 10px #1bc8ce) brightness(1.1); }
        }

        .item-card.equipado { 
            border-color: var(--ouro) !important; 
            filter: drop-shadow(0 0 15px var(--ouro));
            box-shadow: inset 0 0 15px rgba(200, 155, 60, 0.2);
        }

        .icon-container { 
            width: 80px; 
            height: 80px; 
            margin: 0 auto 15px; 
            position: relative; 
            overflow: hidden; 
            border-radius: 50%; 
            transition: 0.3s;
        }

        /* --- ATUALIZADO: TAMANHO 100PX PARA PRISM√ÅTICOS NO INVENT√ÅRIO --- */
        .item-card.prismatico .icon-container {
            width: 100px;
            height: 100px;
        }

        .img-item { 
            width: 100%; 
            height: 100%; 
            border-radius: 50%; 
            object-fit: cover; 
        }

        .item-card.tipo-item .icon-container,
        .item-card.tipo-item .img-item {
            border-radius: 4px !important; 
        }

        .item-nome { 
            font-weight: 900; 
            text-transform: uppercase; 
            font-size: 0.8rem; 
            margin-bottom: 5px; 
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
        }

        .tag-tipo {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: var(--ouro-claro);
            opacity: 0.6;
        }

        .raridade-label {
            font-size: 10px;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }
        .comum .raridade-label { color: var(--comum); }
        .raro .raridade-label { color: var(--raro); }
        .epico .raridade-label { color: var(--epico); }
        
        /* LABEL PRISM√ÅTICA */
        .prismatico .raridade-label {
            background: var(--prismatico);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: brightness(1.3);
            font-weight: 900;
        }

        .btn-acao {
            background: linear-gradient(to bottom, #1e2328, #010a13);
            border: 1px solid var(--ouro);
            color: var(--ouro);
            padding: 8px;
            width: 100%;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 0.7rem;
            clip-path: polygon(10% 0, 90% 0, 100% 50%, 90% 100%, 10% 100%, 0 50%);
            transition: 0.3s;
        }

        .btn-acao:hover:not(:disabled) { background: var(--ouro); color: black; }
        
        .btn-acao.equipado { 
            background: var(--ouro) !important; 
            color: black !important; 
            border-color: var(--ouro-claro); 
            cursor: default;
        }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: var(--azul-hex); border: 2px solid var(--ouro); padding: 30px; max-width: 350px; text-align: center; clip-path: polygon(10% 0, 90% 0, 100% 15%, 100% 85%, 90% 100%, 10% 100%, 0 85%, 0 15%); }
        .modal-nome { color: var(--ouro); font-weight: bold; text-transform: uppercase; margin-bottom: 10px; font-size: 1.1rem; }
        .modal-msg { color: #f0e6d2; font-size: 0.9rem; margin-bottom: 25px; line-height: 1.4; }
        .btn-confirm { background: var(--ouro); border: 1px solid var(--ouro-claro); color: black; padding: 10px 20px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin: 5px; }
        .btn-cancel { background: transparent; border: 1px solid var(--ouro); color: var(--ouro); padding: 10px 20px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin: 5px; }

        .vazio { grid-column: 1/-1; text-align: center; padding: 100px; opacity: 0.5; font-style: italic; }
        .btn-voltar { text-decoration: none; color: var(--ouro); border: 1px solid var(--ouro); padding: 5px 15px; font-size: 0.8rem; text-transform: uppercase; transition: 0.3s; }
        .btn-voltar:hover { background: var(--ouro); color: black; }
    </style>
</head>
<body>

    <div class="header-inv">
        <h1>Invent√°rio Hextech</h1>
        <a href="resgate.html" class="btn-voltar">Voltar para Resgate</a>
    </div>

    <div class="barra-ferramentas-inventario">
        <div class="busca-container-inv">
            <input type="text" id="input-busca-inv" placeholder="PESQUISAR NO INVENT√ÅRIO..." oninput="filtrarPorTexto(this.value)">
            <span>üîç</span>
        </div>
        <div class="filtros-raridade-inv">
            <button class="filter-btn-inv active" onclick="setFiltroRaridade('todos', this)">Todos</button>
            <button class="filter-btn-inv" onclick="setFiltroRaridade('comum', this)">Comum</button>
            <button class="filter-btn-inv" onclick="setFiltroRaridade('raro', this)">Raro</button>
            <button class="filter-btn-inv" onclick="setFiltroRaridade('epico', this)">√âpico</button>
            <button class="filter-btn-inv" onclick="setFiltroRaridade('prismatico', this)">Prism√°tico</button>
        </div>
    </div>

    <div class="grid-inventario" id="grid-inv">
        </div>

    <div class="modal-overlay" id="modal-confirm">
        <div class="modal-content">
            <div class="modal-nome" id="modal-title">CONFIRMAR A√á√ÉO</div>
            <div class="modal-msg" id="modal-message">Deseja realizar esta a√ß√£o?</div>
            <div id="container-btns-modal">
                </div>
        </div>
    </div>
    <div class="header-inv">
        <h1>Meu Invent√°rio</h1>
        <a href="resgate.html" class="btn-voltar">Voltar</a>
    </div>

    <div class="grid-inventario" id="grid-inv">
        <p class="vazio">Carregando seus esp√≥lios...</p>
    </div>

    <div class="modal-overlay" id="modal-confirm">
        <div class="modal-content">
            <div id="modal-title" class="modal-nome">ATIVAR ITEM?</div>
            <div id="modal-message" class="modal-msg"></div>
            <div class="modal-btns" id="container-btns-modal">
                <button class="btn-confirm" id="btn-sim">Sim, Confirmar</button>
                <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, arrayRemove, getDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4dm0KoyJswhyCY7tgbF4D2nmuZl84X8E",
            authDomain: "quizlegends-f58fc.firebaseapp.com",
            projectId: "quizlegends-f58fc",
            storageBucket: "quizlegends-f58fc.firebasestorage.app",
            messagingSenderId: "1050463164018",
            appId: "1:1050463164018:web:91de002b8afc8e678f54eb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const DATA_BASE = {
            // --- √çCONES ---
            'aatrox_comum': { nome: "Aatrox", tipo: "icone", raridade: "comum", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-comum.png" },
            'aatrox_raro': { nome: "Aatrox Ca√ßador dos Mares", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-raro.png" },
            'aatrox_epico': { nome: "Aatrox Justiceiro", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-epico.png" },
            'aatrox-mech': { nome: "Mech Aatrox", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-mech-epico.png" },
            'aatrox-drx': { nome: "Aatrox DRX", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-drx-epico.png" },
            'aatrox-eclipse': { nome: "Aatrox Eclipse Lunar", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-eclipse-epico.png" },
            'aatrox-odisseia': { nome: "Aatrox Odisseia", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-odisseia-epico.png" },
            'aatrox-vitorioso': { nome: "Aatrox Vitorioso", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-vitorioso-epico.png" },
            'aatrox-lua': { nome: "Aatrox Lua Sangrenta", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-lua-epico.png" },
            'aatrox-primordiano': { nome: "Aatrox Primordiano", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-primordiano-prismatico.gif" },
            'aatrox-prestigio': { nome: "Aatrox Lua Sangrenta de Prest√≠gio", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-lua-prestigio-prismatico.gif" },
            'aatrox-drx-prestigio': { nome: "Aatrox DRX de Prest√≠gio", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/aatrox-drx-prestigio-prismatico.gif" },
            
            'ahri_comum': { nome: "Ahri", tipo: "icone", raridade: "comum", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-comum.png" },
            'ahri_raro': { nome: "Ahri Raposa Flamejante", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-raro.png" },
            'ahri_epico': { nome: "Ahri K/DA", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-epico.png" },
            'ahri-imortalizada': { nome: "Ahri Lenda imortalizada", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-imortalizada-epico.png" },
            'ahri-ascendida': { nome: "Ahri Lenda Ascendida", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-ascendida-epico.png" },
            'ahri-lua': { nome: "Ahri Lua Nevada", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-lua-epico.png" },
            'ahri-arcana': { nome: "Ahri Arcana", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-arcana-epico.png" },
            'ahri-bruxa': { nome: "Ahri Congrega√ß√£o das Bruxas", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-bruxa-epico.png" },
            'ahri-allout': { nome: "Ahri K/DA ALL OUT", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-allout-epico.png" },
            'ahri-sabugueiro': { nome: "Ahri Sabugueiro", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-sabugueiro-epico.png" },
            'ahri-fliperama': { nome: "Ahri Fliperama", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-fliperama-epico.png" },
            'ahri-desafiante': { nome: "Ahri Desafiante", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-desafiante-raro.png" },
            'ahri-estrela': { nome: "Ahri Estrela do Pop", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-estrela-raro.png" },
            'ahri-noturna': { nome: "Ahri Noturna", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-noturna-raro.png" },
            'ahri-dinastia': { nome: "Ahri da Dinastia", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-dinastia-raro.png" },
            'ahri-prestigio': { nome: "Ahri K/DA de Prest√≠gio", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-prestigio-prismatico.gif" },
            'ahri-guardi√£': { nome: "Ahri Guardi√£ Estelar", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-guardi√£-prismatico.gif" },
            'ahri-florescer': { nome: "Ahri Florescer Espiritual", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/ahri-florescer-prismatico.gif" },
            
            'akali-comum': { nome: "Akali", tipo: "icone", raridade: "comum", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-comum.png" },
            'akali-stinger': { nome: "Stinger Akali", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-stinger-raro.png" },
            'akali-infernal': { nome: "Akali Infernal", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-infernal-raro.png" },
            'akali-esporte': { nome: "Akali o Astro do esporte", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-esporte-raro.png" },
            'akali-enfermeira': { nome: "Enfermeira Akali", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-enfermeira-raro.png" },
            'akali-kda': { nome: "Akali K/DA", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-kda-epico.png" },
            'akali-lua': { nome: "Akali lua de Sangue", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-lua-epico.png" },
            'akali-presa': { nome: "Akali Presa prateada", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-presa-epico.png" },
            'akali-guardi√£': { nome: "Akali Guardi√£ Estelar", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-guardi√£-prismatico.gif" },
            'akali-coven': { nome: "Akali Prest√≠gio Coven", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-coven-prismatico.gif" },
            'akali-prestigio': { nome: "Akali K/DA de Prest√≠gio", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akali-prestigio-prismatico.gif" },
          
            'akshan-comum': { nome: "Akshan", tipo: "icone", raridade: "comum", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akshan-comum.png" },
            'akshan-ciberpop': { nome: "Akshan Ciberpop", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akshan-ciberpop-epico.png" },
            'akshan-rosa': { nome: "Akshan Rosa de Cristal", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akshan-rosa-epico.png" },
            'akshan-tres': { nome: "Akshan Tr√™s Honras", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/akshan-tres-prismatico.gif" },

            'alistar-comum': { nome: "Alistar", tipo: "icone", raridade: "comum", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-comum.png" },
            'alistar-negro': { nome: "Alistar Negro", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-negro-raro.png" },
            'alistar-dourado': { nome: "Alistar Dourado", tipo: "icone", raridade: "raro", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-dourado-raro.png" },
            'alistar-toureiro': { nome: "Alistar Toureiro", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-toureiro-epico.png" },
            'alistar-conquistador': { nome: "Alistar Conquistador", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-conquistador-epico.png" },
            'alistar-velhooeste': { nome: "Alistar Velho Oeste", tipo: "icone", raridade: "epico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-velhooeste-epico.png" },
            'alistar-hextech': { nome: "Alistar Hextech", tipo: "icone", raridade: "prismatico", img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/alistar-hextec-prismatico.gif" },
            
            // --- ITENS CONSUM√çVEIS ---
            'anjo_guardiao': { nome: "Anjo Guardi√£o", tipo: "consumivel", raridade: "raro", duracao: 7, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/anjo.png" },
            'sentinela-epico': { nome: "Sentinela de Controle", tipo: "carga", raridade: "epico", unidades: 3, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/sentinela-epico.png" },
            'coletora-comum': { nome: "A Coletora", tipo: "multiplicador", raridade: "comum", duracaoHoras: 2, multiplicadorPDL: 2, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/coletora-comum.png" },
            'gume-raro': { nome: "Gume do Infinito", tipo: "multiplicador", raridade: "raro", duracaoHoras: 2, multiplicadorPDL: 4, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/gume-raro.png" },
            'sedenta-epico': { nome: "Sedenta por Sangue", tipo: "multiplicador", raridade: "epico", duracaoHoras: 2, multiplicadorPDL: 6, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/sedenta-epico.png" },
            'atlas-comum': { nome: "Atlas Mundial", tipo: "multiplicadorMoedas", raridade: "comum", duracaoHoras: 2, multiplicadorMoedas: 2, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/atlas-comum.png" },
            'bussola-raro': { nome: "B√∫ssola R√∫nica", tipo: "multiplicadorMoedas", raridade: "raro", duracaoHoras: 2, multiplicadorMoedas: 4, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/bussola-raro.png" },
            'oposicao-epico': { nome: "Oposi√ß√£o Celestial", tipo: "multiplicadorMoedas", raridade: "epico", duracaoHoras: 2, multiplicadorMoedas: 6, img: "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/oposicao-epico.png" }
        };

        let usuarioDados = {};

        onAuthStateChanged(auth, (user) => {
            if (user) {
                onSnapshot(doc(db, "usuarios", user.uid), (snap) => {
                    if (snap.exists()) {
                        usuarioDados = snap.data();
                        renderInventario();
                    }
                });
            } else {
                window.location.href = "index.html";
            }
        });

    let filtroRaridadeAtivo = 'todos';
    let buscaTextoAtiva = '';

    window.filtrarPorTexto = (valor) => {
        buscaTextoAtiva = valor.toLowerCase();
        renderInventario();
    };

    window.setFiltroRaridade = (raridade, btn) => {
        filtroRaridadeAtivo = raridade;
        document.querySelectorAll('.filter-btn-inv').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderInventario();
    };

    function passaNoFiltro(item) {
        if (!item) return false;
        const nomeBate = item.nome.toLowerCase().includes(buscaTextoAtiva);
        const raridadeBate = (filtroRaridadeAtivo === 'todos' || item.raridade === filtroRaridadeAtivo);
        return nomeBate && raridadeBate;
    }

    function renderInventario() {
        const grid = document.getElementById('grid-inv');
        if (!grid) return;
        grid.innerHTML = "";

        if (typeof usuarioDados === 'undefined' || !usuarioDados) {
            grid.innerHTML = '<p class="vazio">Carregando esp√≥lios...</p>';
            return;
        }

        const icones = usuarioDados.iconesAdquiridos || [];
        const mochila = usuarioDados.mochila || [];
        const iconeEquipado = usuarioDados.iconeAtual || "";

        if (icones.length === 0 && mochila.length === 0) {
            grid.innerHTML = '<p class="vazio">Voc√™ ainda n√£o possui itens ou √≠cones.</p>';
            return;
        }

        let itensVisiveis = 0;

        mochila.forEach(id => {
            const item = DATA_BASE[id];
            if (!item) return;
            if (passaNoFiltro(item)) {
                grid.innerHTML += criarCard(id, item, "ATIVAR", false, true);
                itensVisiveis++;
            }
        });

        icones.forEach(id => {
            const item = DATA_BASE[id];
            if (!item) return;
            if (passaNoFiltro(item)) {
                const nomeArquivo = item.img.split('/').pop().replace('.png', '');
                const estaEquipado = (nomeArquivo === iconeEquipado);
                grid.innerHTML += criarCard(id, item, estaEquipado ? "EQUIPADO" : "EQUIPAR", estaEquipado, false);
                itensVisiveis++;
            }
        });

        if (itensVisiveis === 0 && (buscaTextoAtiva !== '' || filtroRaridadeAtivo !== 'todos')) {
            grid.innerHTML = '<p class="vazio">Nenhum item encontrado para esta busca.</p>';
        }
    }

    function criarCard(id, item, txtBotao, isEquipado, isQuadrado) {
        let tagTexto = "Consum√≠vel";
        if (item.tipo === 'icone') tagTexto = "√çcone de Perfil";
        if (item.tipo === 'carga') tagTexto = "Utiliz√°vel";
        if (item.tipo === 'multiplicador') tagTexto = `B√¥nus ${item.multiplicadorPDL}x PDL`;
        if (item.tipo === 'multiplicadorMoedas') tagTexto = `B√¥nus ${item.multiplicadorMoedas}x Moedas`;

        let labelRaridade = "";
        if (item.raridade === 'epico') labelRaridade = '√âpico';
        else if (item.raridade === 'prismatico') labelRaridade = 'Prism√°tico';
        else labelRaridade = item.raridade.charAt(0).toUpperCase() + item.raridade.slice(1);
        
        const classeFormato = isQuadrado ? 'tipo-item' : '';

        let urlImagem = item.img;
        if (item.raridade === 'prismatico') {
            urlImagem = urlImagem.replace('.png', '.gif');
        }

        return `
            <div class="item-card ${item.raridade} ${isEquipado ? 'equipado' : ''} ${classeFormato}">
                <div class="tag-tipo">${tagTexto}</div>
                <div class="icon-container">
                    <img src="${urlImagem}" class="img-item">
                </div>
                <div class="item-nome">${item.nome}</div>
                <div class="raridade-label">${labelRaridade}</div>
                <button class="btn-acao ${isEquipado ? 'equipado' : ''}" 
                    onclick="acaoItem('${id}', '${item.tipo}')" ${isEquipado ? 'disabled' : ''}>
                    ${txtBotao}
                </button>
            </div>
        `;
    }

    window.acaoItem = (id, tipo) => {
        const item = DATA_BASE[id];
        const modal = document.getElementById('modal-confirm');
        const msg = document.getElementById('modal-message');
        const titulo = document.getElementById('modal-title');
        
        document.getElementById('container-btns-modal').innerHTML = `
            <button class="btn-confirm" id="btn-sim">Sim, Confirmar</button>
            <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
        `;
        const novoBtnSim = document.getElementById('btn-sim');

        if (tipo === 'icone') {
            titulo.innerText = "EQUIPAR √çCONE";
            msg.innerText = `Deseja equipar "${item.nome}" como seu √≠cone de perfil?`;
            novoBtnSim.onclick = () => equiparIcone(id);
        } else if (tipo === 'carga') {
            titulo.innerText = "ATIVAR REVELA√á√ÉO";
            msg.innerText = `Deseja ativar "${item.nome}"? Isso adicionar√° ${item.unidades} cargas de revela√ß√£o ao seu Quiz.`;
            novoBtnSim.onclick = () => ativarSentinela(id);
        } else if (tipo === 'multiplicador') {
            titulo.innerText = "ATIVAR MULTIPLICADOR";
            const agora = Date.now();
            if (usuarioDados.statusAtivo?.dobrador_pdl && agora < usuarioDados.statusAtivo.dobrador_pdl) {
                titulo.innerText = "ATEN√á√ÉO INVOCADOR";
                msg.innerHTML = `<span style="color:var(--ouro)">Voc√™ j√° possui um multiplicador de PDL ativo!</span><br><br>Se ativar este agora, o tempo e o valor (${item.multiplicadorPDL}x) do novo item substituir√£o o anterior. Deseja prosseguir?`;
            } else {
                msg.innerText = `Deseja ativar "${item.nome}" agora? Isso multiplicar√° seus ganhos de PDL por ${item.multiplicadorPDL} durante ${item.duracaoHoras} horas.`;
            }
            novoBtnSim.onclick = () => ativarMultiplicador(id);
        } else if (tipo === 'multiplicadorMoedas') {
            titulo.innerText = "ATIVAR " + item.nome.toUpperCase();
            const agora = Date.now();
            if (usuarioDados.statusAtivo?.dobrador_moedas && agora < usuarioDados.statusAtivo.dobrador_moedas) {
                titulo.innerText = "ATEN√á√ÉO INVOCADOR";
                msg.innerHTML = `<span style="color:var(--ouro)">Voc√™ j√° possui um b√¥nus de moedas ativo!</span><br><br>Substituir o efeito atual pelo novo b√¥nus (${item.multiplicadorMoedas}x)?`;
            } else {
                msg.innerText = `Deseja ativar "${item.nome}" agora? Isso multiplicar√° seus ganhos de Moedas por ${item.multiplicadorMoedas} durante ${item.duracaoHoras} horas.`;
            }
            novoBtnSim.onclick = () => ativarMultiplicadorMoedas(id);
        } else {
            titulo.innerText = "ATIVAR CONSUM√çVEL";
            msg.innerText = `Deseja ativar "${item.nome}" agora? Isso iniciar√° o tempo de ${item.duracao} dias (acumulativo).`;
            novoBtnSim.onclick = () => ativarConsumivel(id);
        }
        modal.style.display = 'flex';
    };

    window.fecharModal = () => { document.getElementById('modal-confirm').style.display = 'none'; };

    function mostrarModalSucesso(titulo, htmlConteudo) {
        const modal = document.getElementById('modal-confirm');
        document.getElementById('modal-title').innerText = titulo;
        document.getElementById('modal-message').innerHTML = htmlConteudo;
        document.getElementById('container-btns-modal').innerHTML = `<button class="btn-confirm" onclick="fecharModal()">OK</button>`;
        modal.style.display = 'flex';
    }

    async function equiparIcone(id) {
        fecharModal();
        try {
            const item = DATA_BASE[id];
            if (!item) return;
            const nomeArquivo = item.img.split('/').pop().replace('.png', '');
            const userRef = doc(db, "usuarios", auth.currentUser.uid);
            await updateDoc(userRef, { iconeAtual: nomeArquivo });
        } catch (e) { console.error(e); }
    }

    async function ativarSentinela(id) {
        fecharModal();
        const item = DATA_BASE[id];
        const userRef = doc(db, "usuarios", auth.currentUser.uid);
        try {
            await updateDoc(userRef, {
                mochila: arrayRemove(id),
                "statusAtivo.sentinelas": increment(3)
            });
            mostrarModalSucesso("SUCESSO", `<p style="color:var(--raro)">${item.nome} Ativada!</p><p>Cargas adicionadas com sucesso.</p>`);
        } catch (e) { console.error(e); }
    }

    async function ativarMultiplicador(id) {
        fecharModal();
        const item = DATA_BASE[id];
        const userRef = doc(db, "usuarios", auth.currentUser.uid);
        const agora = Date.now();
        const duracaoMs = item.duracaoHoras * 60 * 60 * 1000;
        const multiplicador = item.multiplicadorPDL;
        try {
            await updateDoc(userRef, {
                mochila: arrayRemove(id),
                "statusAtivo.dobrador_pdl": agora + duracaoMs,
                "statusAtivo.valor_multiplicador": multiplicador
            });
            let textoEfeito = "DOBRADOS";
            if (multiplicador === 4) textoEfeito = "QUADRUPLICADOS";
            if (multiplicador === 6) textoEfeito = "SEXTUPLICADOS";
            mostrarModalSucesso("B√îNUS ATIVADO", `<p>Seus ganhos de PDL est√£o <strong>${textoEfeito}</strong> por ${item.duracaoHoras}h.</p>`);
        } catch (e) { console.error(e); }
    }

    async function ativarMultiplicadorMoedas(id) {
        fecharModal();
        const item = DATA_BASE[id];
        const userRef = doc(db, "usuarios", auth.currentUser.uid);
        const agora = Date.now();
        const duracaoMs = item.duracaoHoras * 60 * 60 * 1000;
        const multiplicador = item.multiplicadorMoedas;
        try {
            await updateDoc(userRef, {
                mochila: arrayRemove(id),
                "statusAtivo.dobrador_moedas": agora + duracaoMs,
                "statusAtivo.valor_multiplicador_moedas": multiplicador
            });
            let textoEfeito = "DOBRADOS";
            if (multiplicador === 4) textoEfeito = "QUADRUPLICADOS";
            if (multiplicador === 6) textoEfeito = "SEXTUPLICADOS";
            mostrarModalSucesso("B√îNUS ATIVADO", `<p>O item <strong>${item.nome}</strong> est√° ativo! Ganhos de moedas est√£o <strong>${textoEfeito}</strong> (${multiplicador}x) por ${item.duracaoHoras}h.</p>`);
        } catch (e) { console.error(e); }
    }

    async function ativarConsumivel(id) {
        fecharModal();
        const item = DATA_BASE[id];
        const userRef = doc(db, "usuarios", auth.currentUser.uid);
        const agora = Date.now();
        const tempoMs = item.duracao * 24 * 60 * 60 * 1000; 
        try {
            const snap = await getDoc(userRef);
            const dados = snap.data();
            const tempoAtual = (dados.statusAtivo && dados.statusAtivo[id] > agora) ? dados.statusAtivo[id] : agora;
            const novaValidade = tempoAtual + tempoMs;
            await updateDoc(userRef, {
                mochila: arrayRemove(id),
                [`statusAtivo.${id}`]: novaValidade
            });
            mostrarModalSucesso("SUCESSO", `<p>${item.nome} Ativado!</p>`);
        } catch (e) { console.error(e); }
    }
</script>
  </body>
</html>
